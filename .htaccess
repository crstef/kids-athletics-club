# Passenger Configuration for Node.js
PassengerAppRoot "/home/jmwclpii/domains/kidsathletic.hardweb.ro/public_html"
PassengerBaseURI "/"
PassengerNodejs "/home/jmwclpii/nodevenv/domains/kidsathletic.hardweb.ro/public_html/20/bin/node"
PassengerAppType node
PassengerStartupFile app.cjs

# Set environment to production
SetEnv NODE_ENV production

# Add MIME types for assets
<IfModule mod_mime.c>
  AddType application/javascript js
  AddType text/css css
  AddType application/json json
  AddType font/woff2 woff2
  AddType font/woff woff
  AddEncoding gzip gz
</IfModule>

# Force correct Content-Type headers for static files
<IfModule mod_headers.c>
  <FilesMatch "\.(js)$">
    Header set Content-Type "application/javascript; charset=utf-8"
  </FilesMatch>
  <FilesMatch "\.(css)$">
    Header set Content-Type "text/css; charset=utf-8"
  </FilesMatch>
</IfModule>

# Enable Apache modules
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  
  # Don't rewrite /api routes - let Passenger backend handle them
  RewriteRule ^api($|/) - [L]
  
  # CRITICAL: If request is for an existing file or directory, don't rewrite
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]
  
  # Rewrite everything else to index.html (React Router SPA)
  RewriteRule ^.*$ /index.html [QSA,L]
</IfModule>

# Set proper headers for assets
<FilesMatch "\.(js|css|json|woff|woff2|ttf|eot|svg)$">
  Header set Cache-Control "public, max-age=31536000"
</FilesMatch>

# Ensure index.html is not cached (always fresh for SPA)
<Files "index.html">
  Header set Cache-Control "no-cache, no-store, must-revalidate"
</Files>
